<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apps & Widgets - Smack API Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --bg: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-card-hover: #252542;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #2d2d4a;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --pink: #f472b6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        nav {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        nav a.logo {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text);
            text-decoration: none;
        }

        nav .nav-links {
            display: flex;
            gap: 24px;
        }

        nav .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        nav .nav-links a:hover,
        nav .nav-links a.active {
            color: var(--primary-light);
        }

        .page-header {
            background: linear-gradient(180deg, rgba(244, 114, 182, 0.1) 0%, transparent 100%);
            padding: 60px 20px;
            border-bottom: 1px solid var(--border);
        }

        .page-header .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .page-header p {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 48px 0 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        h2:first-child { margin-top: 0; }

        h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 28px 0 12px;
            color: var(--text);
        }

        p { margin-bottom: 16px; color: var(--text-muted); }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .feature-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            font-size: 0.9rem;
            margin: 0;
        }

        .info-box {
            background: rgba(244, 114, 182, 0.1);
            border: 1px solid rgba(244, 114, 182, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
        }

        .info-box.purple {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .info-box.green {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .info-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .info-box p { margin: 0; font-size: 0.9rem; }

        .code-block {
            background: #0d0d1a;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
        }

        .code-header {
            background: var(--bg-card);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-header span {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .method-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            font-family: 'JetBrains Mono', monospace;
        }

        .method-badge.post { background: #059669; color: white; }
        .method-badge.get { background: #3b82f6; color: white; }
        .method-badge.put { background: #f59e0b; color: white; }
        .method-badge.delete { background: #ef4444; color: white; }

        .code-content {
            padding: 16px 20px;
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .code-content .comment { color: #6b7280; }
        .code-content .string { color: #34d399; }
        .code-content .keyword { color: #f472b6; }
        .code-content .property { color: #60a5fa; }
        .code-content .number { color: #fbbf24; }

        .endpoint {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 24px 0;
            overflow: hidden;
        }

        .endpoint-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .endpoint-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            color: var(--text);
        }

        .endpoint-desc {
            padding: 16px 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border);
        }

        .endpoint-body { padding: 20px; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }

        th {
            text-align: left;
            padding: 12px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        td code {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(99, 102, 241, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--primary-light);
        }

        .required { color: var(--danger); font-size: 0.7rem; font-weight: 500; }
        .optional { color: var(--text-muted); font-size: 0.7rem; }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.owner { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .badge.admin { background: rgba(99, 102, 241, 0.2); color: #818cf8; }
        .badge.member { background: rgba(16, 185, 129, 0.2); color: #34d399; }

        footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: 40px 20px;
            text-align: center;
            margin-top: 60px;
        }

        footer p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">Smack API</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="authentication.html">Auth</a>
                <a href="api-reference.html">API</a>
                <a href="websocket.html">WebSocket</a>
                <a href="webhooks.html">Webhooks</a>
                <a href="apps-widgets.html" class="active">Apps</a>
                <a href="kanban.html">Kanban</a>
                <a href="commands.html">Commands</a>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1>Apps & Widgets</h1>
            <p>Build custom web applications with AI-powered development and private databases</p>
        </div>
    </div>

    <div class="content">
        <h2>Overview</h2>
        <p>Smack Apps let you create custom web applications directly in Smack. Each app gets its own HTML, CSS, and JavaScript code, a private SQLite database, and AI chat assistance for development.</p>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>&#128421; AI-Powered Development</h4>
                <p>Chat with an AI assistant to build your app. Describe what you want and watch it generate code in real-time.</p>
            </div>
            <div class="feature-card">
                <h4>&#128450; Private Database</h4>
                <p>Each app has its own SQLite database for persistent storage. Create tables, store data, and query it from your JavaScript.</p>
            </div>
            <div class="feature-card">
                <h4>&#128260; Live Preview</h4>
                <p>See your changes instantly with live preview. Code updates are streamed in real-time via WebSocket.</p>
            </div>
            <div class="feature-card">
                <h4>&#128101; Team Collaboration</h4>
                <p>Share apps with team members. Set roles (owner, admin, member) to control who can edit or view.</p>
            </div>
        </div>

        <h2>App CRUD Operations</h2>

        <h3>Create an App</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge post">POST</span>
                <span class="endpoint-path">/api/apps</span>
            </div>
            <div class="endpoint-body">
                <table>
                    <thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><code>name</code> <span class="required">required</span></td>
                            <td>string</td>
                            <td>App name</td>
                        </tr>
                        <tr>
                            <td><code>description</code> <span class="optional">optional</span></td>
                            <td>string</td>
                            <td>App description</td>
                        </tr>
                        <tr>
                            <td><code>icon</code> <span class="optional">optional</span></td>
                            <td>string</td>
                            <td>Emoji or icon URL</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>Response</span><span style="color: var(--success);">201 Created</span></div>
            <div class="code-content">
<pre>{
  <span class="property">"id"</span>: <span class="string">"app-uuid"</span>,
  <span class="property">"name"</span>: <span class="string">"Todo List"</span>,
  <span class="property">"description"</span>: <span class="string">"A simple todo list app"</span>,
  <span class="property">"icon"</span>: <span class="string">"&#9989;"</span>,
  <span class="property">"html_content"</span>: <span class="string">""</span>,
  <span class="property">"css_content"</span>: <span class="string">""</span>,
  <span class="property">"js_content"</span>: <span class="string">""</span>,
  <span class="property">"created_by"</span>: <span class="string">"user-uuid"</span>,
  <span class="property">"created_at"</span>: <span class="string">"2024-01-15T10:30:00Z"</span>,
  <span class="property">"updated_at"</span>: <span class="string">"2024-01-15T10:30:00Z"</span>
}</pre>
            </div>
        </div>

        <h3>Other App Endpoints</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="method-badge get">GET</span></td><td><code>/api/apps</code></td><td>List your apps</td></tr>
                <tr><td><span class="method-badge get">GET</span></td><td><code>/api/apps/{id}</code></td><td>Get app details</td></tr>
                <tr><td><span class="method-badge put">PUT</span></td><td><code>/api/apps/{id}</code></td><td>Update app metadata</td></tr>
                <tr><td><span class="method-badge delete">DELETE</span></td><td><code>/api/apps/{id}</code></td><td>Delete app (owner only)</td></tr>
            </tbody>
        </table>

        <h2>App Code</h2>
        <p>Each app stores separate HTML, CSS, and JavaScript content. The HTML is rendered inside a full document with your CSS and JS included.</p>

        <h3>Get App Code</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge get">GET</span>
                <span class="endpoint-path">/api/apps/{id}/code</span>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>Response</span></div>
            <div class="code-content">
<pre>{
  <span class="property">"html_content"</span>: <span class="string">"&lt;div class='todo-app'&gt;...&lt;/div&gt;"</span>,
  <span class="property">"css_content"</span>: <span class="string">".todo-app { padding: 20px; }"</span>,
  <span class="property">"js_content"</span>: <span class="string">"async function loadTodos() { ... }"</span>
}</pre>
            </div>
        </div>

        <h3>Update App Code</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge put">PUT</span>
                <span class="endpoint-path">/api/apps/{id}/code</span>
            </div>
            <div class="endpoint-body">
                <table>
                    <thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>html_content</code></td><td>string</td><td>Body HTML (no html/head/body tags)</td></tr>
                        <tr><td><code>css_content</code></td><td>string</td><td>CSS styles</td></tr>
                        <tr><td><code>js_content</code></td><td>string</td><td>JavaScript code</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="info-box">
            <h4>Code Structure</h4>
            <p>Your HTML should only contain body content (no <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, or <code>&lt;body&gt;</code> tags). Smack wraps your code in a full document with your CSS in a <code>&lt;style&gt;</code> tag and JS in a <code>&lt;script&gt;</code> tag.</p>
        </div>

        <h3>Safe Areas</h3>
        <p>Apps run in a WebView alongside the Smack sidebar and toolbar. CSS variables are provided so your app can properly position elements within the visible content area. These variables update dynamically when the sidebar is resized.</p>

        <div class="code-block">
            <div class="code-header"><span>Available CSS Variables</span></div>
            <div class="code-content">
<pre><span class="comment">/* Injected by Smack - updated dynamically when sidebar resizes */</span>
:root {
  <span class="property">--sidebar-width</span>: <span class="number">240px</span>;      <span class="comment">/* Current sidebar width (live updated) */</span>
  <span class="property">--safe-area-left</span>: <span class="number">264px</span>;    <span class="comment">/* sidebar + 24px padding (live updated) */</span>
  <span class="property">--toolbar-height</span>: <span class="number">52px</span>;     <span class="comment">/* macOS toolbar height (constant) */</span>
  <span class="property">--safe-area-top</span>: <span class="number">76px</span>;      <span class="comment">/* toolbar + 24px padding (constant) */</span>
}</pre>
            </div>
        </div>

        <p>Use these variables for fixed or sticky positioned elements:</p>

        <div class="code-block">
            <div class="code-header"><span>Example: Fixed Header</span></div>
            <div class="code-content">
<pre><span class="comment">/* Fixed header that respects safe areas */</span>
header {
  <span class="property">position</span>: fixed;
  <span class="property">top</span>: <span class="keyword">var</span>(<span class="string">--safe-area-top</span>, <span class="number">76px</span>);
  <span class="property">left</span>: <span class="keyword">var</span>(<span class="string">--safe-area-left</span>, <span class="number">264px</span>);
  <span class="property">right</span>: <span class="number">24px</span>;
  <span class="property">z-index</span>: <span class="number">10</span>;
}

<span class="comment">/* Main content with space for fixed header */</span>
main {
  <span class="property">padding-left</span>: <span class="keyword">var</span>(<span class="string">--safe-area-left</span>, <span class="number">264px</span>);
  <span class="property">padding-top</span>: <span class="keyword">calc</span>(<span class="keyword">var</span>(<span class="string">--safe-area-top</span>, <span class="number">76px</span>) + <span class="number">80px</span>);
  <span class="property">padding-right</span>: <span class="number">24px</span>;
}

<span class="comment">/* Modal backdrop within content area */</span>
.modal-backdrop {
  <span class="property">position</span>: fixed;
  <span class="property">top</span>: <span class="keyword">var</span>(<span class="string">--safe-area-top</span>, <span class="number">76px</span>);
  <span class="property">left</span>: <span class="keyword">var</span>(<span class="string">--safe-area-left</span>, <span class="number">264px</span>);
  <span class="property">right</span>: <span class="number">0</span>;
  <span class="property">bottom</span>: <span class="number">0</span>;
}</pre>
            </div>
        </div>

        <div class="info-box green">
            <h4>Dynamic Updates</h4>
            <p>When the user resizes the sidebar, <code>--sidebar-width</code> and <code>--safe-area-left</code> are automatically updated via JavaScript. Your CSS will respond instantly without page reload. Always provide fallback values (e.g., <code>var(--safe-area-left, 264px)</code>) for robustness.</p>
        </div>

        <h3>Serve App</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge get">GET</span>
                <span class="endpoint-path">/api/apps/{id}/serve</span>
            </div>
            <div class="endpoint-desc">Renders the app as a complete HTML page. Use this in an iframe for preview.</div>
        </div>

        <h2>SmackDB - App Database</h2>
        <p>Each app has its own private SQLite database. Use the <code>SmackDB</code> JavaScript API to interact with it.</p>

        <div class="info-box green">
            <h4>Database Features</h4>
            <p>
                <strong>Persistent:</strong> Data is stored on the server and persists across sessions<br>
                <strong>Private:</strong> Each app has its own isolated database<br>
                <strong>SQL:</strong> Full SQLite support with parameterized queries
            </p>
        </div>

        <h3>SmackDB API</h3>
        <div class="code-block">
            <div class="code-header"><span>SmackDB.query(sql, params)</span></div>
            <div class="code-content">
<pre><span class="comment">// Returns: Promise&lt;{ columns, rows, error }&gt;</span>

<span class="comment">// Create a table</span>
<span class="keyword">await</span> SmackDB.query(<span class="string">`
  CREATE TABLE IF NOT EXISTS todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    done INTEGER DEFAULT 0,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP
  )
`</span>);

<span class="comment">// Insert data</span>
<span class="keyword">await</span> SmackDB.query(
  <span class="string">"INSERT INTO todos (title, done) VALUES (?, ?)"</span>,
  [<span class="string">"Buy groceries"</span>, <span class="number">0</span>]
);

<span class="comment">// Query data</span>
<span class="keyword">const</span> result = <span class="keyword">await</span> SmackDB.query(
  <span class="string">"SELECT * FROM todos WHERE done = ? ORDER BY created_at DESC"</span>,
  [<span class="number">0</span>]
);

<span class="keyword">if</span> (result.error) {
  console.error(<span class="string">"Database error:"</span>, result.error);
} <span class="keyword">else</span> {
  console.log(result.rows); <span class="comment">// [{id: 1, title: "Buy groceries", ...}]</span>
}

<span class="comment">// Update data</span>
<span class="keyword">await</span> SmackDB.query(
  <span class="string">"UPDATE todos SET done = ? WHERE id = ?"</span>,
  [<span class="number">1</span>, <span class="number">5</span>]
);

<span class="comment">// Delete data</span>
<span class="keyword">await</span> SmackDB.query(
  <span class="string">"DELETE FROM todos WHERE id = ?"</span>,
  [<span class="number">5</span>]
);</pre>
            </div>
        </div>

        <h3>Query Endpoint</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge post">POST</span>
                <span class="endpoint-path">/api/apps/{id}/query</span>
            </div>
            <div class="endpoint-body">
                <table>
                    <thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>query</code> <span class="required">required</span></td><td>string</td><td>SQL query</td></tr>
                        <tr><td><code>params</code> <span class="optional">optional</span></td><td>array</td><td>Query parameters</td></tr>
                    </tbody>
                </table>
                <p style="margin-top: 16px;"><strong>Allowed queries:</strong> SELECT, INSERT, UPDATE, DELETE, CREATE TABLE, CREATE INDEX</p>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>Response (SELECT)</span></div>
            <div class="code-content">
<pre>{
  <span class="property">"columns"</span>: [<span class="string">"id"</span>, <span class="string">"title"</span>, <span class="string">"done"</span>, <span class="string">"created_at"</span>],
  <span class="property">"rows"</span>: [
    {<span class="property">"id"</span>: <span class="number">1</span>, <span class="property">"title"</span>: <span class="string">"Buy groceries"</span>, <span class="property">"done"</span>: <span class="number">0</span>, <span class="property">"created_at"</span>: <span class="string">"2024-01-15"</span>}
  ]
}</pre>
            </div>
        </div>

        <h2>AI Chat</h2>
        <p>Chat with an AI assistant to build your app. The AI can generate and update code in real-time using the <code>update_code</code> function.</p>

        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge post">POST</span>
                <span class="endpoint-path">/api/apps/{id}/chat</span>
            </div>
            <div class="endpoint-body">
                <table>
                    <thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>message</code> <span class="required">required</span></td><td>string</td><td>Your message to the AI</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>Example Request</span></div>
            <div class="code-content">
<pre>curl -X POST http://localhost:8080/api/apps/APP_ID/chat \
  -H <span class="string">"Authorization: Bearer TOKEN"</span> \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{"message": "Create a todo list app with add and delete functionality"}'</span></pre>
            </div>
        </div>

        <div class="info-box purple">
            <h4>AI Capabilities</h4>
            <p>The AI assistant understands your app's current code and can:<br>
            <strong>1.</strong> Generate HTML, CSS, and JavaScript<br>
            <strong>2.</strong> Create database schemas<br>
            <strong>3.</strong> Implement CRUD operations with SmackDB<br>
            <strong>4.</strong> Fix bugs and refactor code<br>
            <strong>5.</strong> Explain how the code works</p>
        </div>

        <h3>Chat History</h3>
        <div class="endpoint">
            <div class="endpoint-header">
                <span class="method-badge get">GET</span>
                <span class="endpoint-path">/api/apps/{id}/chat/history</span>
            </div>
            <div class="endpoint-desc">Get the last 50 messages in the AI conversation</div>
        </div>

        <h2>App Members</h2>
        <p>Share apps with team members using role-based access control.</p>

        <h3>Member Roles</h3>
        <table>
            <thead><tr><th>Role</th><th>Permissions</th></tr></thead>
            <tbody>
                <tr><td><span class="badge owner">Owner</span></td><td>Full control including delete and member management</td></tr>
                <tr><td><span class="badge admin">Admin</span></td><td>Edit code, manage members (except owner)</td></tr>
                <tr><td><span class="badge member">Member</span></td><td>View and edit code, use AI chat</td></tr>
            </tbody>
        </table>

        <h3>Member Endpoints</h3>
        <table>
            <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><span class="method-badge get">GET</span></td><td><code>/api/apps/{id}/members</code></td><td>List app members</td></tr>
                <tr><td><span class="method-badge post">POST</span></td><td><code>/api/apps/{id}/members</code></td><td>Add member</td></tr>
                <tr><td><span class="method-badge delete">DELETE</span></td><td><code>/api/apps/{id}/members/{userId}</code></td><td>Remove member</td></tr>
            </tbody>
        </table>

        <div class="code-block">
            <div class="code-header"><span>Add Member Request</span></div>
            <div class="code-content">
<pre>{
  <span class="property">"user_id"</span>: <span class="string">"user-uuid"</span>,
  <span class="property">"role"</span>: <span class="string">"member"</span>  <span class="comment">// optional, defaults to "member"</span>
}</pre>
            </div>
        </div>

        <h2>WebSocket Events</h2>
        <p>Apps have their own WebSocket events for real-time updates.</p>

        <table>
            <thead><tr><th>Event Type</th><th>Description</th></tr></thead>
            <tbody>
                <tr><td><code>app_code_updated</code></td><td>Code was modified (includes new HTML/CSS/JS)</td></tr>
                <tr><td><code>app_stream_start</code></td><td>AI chat response streaming started</td></tr>
                <tr><td><code>app_stream_delta</code></td><td>AI streaming chunk received</td></tr>
                <tr><td><code>app_stream_end</code></td><td>AI streaming complete</td></tr>
            </tbody>
        </table>

        <div class="code-block">
            <div class="code-header"><span>app_code_updated Event</span></div>
            <div class="code-content">
<pre>{
  <span class="property">"type"</span>: <span class="string">"app_code_updated"</span>,
  <span class="property">"payload"</span>: {
    <span class="property">"app_id"</span>: <span class="string">"app-uuid"</span>,
    <span class="property">"html_content"</span>: <span class="string">"&lt;div&gt;...&lt;/div&gt;"</span>,
    <span class="property">"css_content"</span>: <span class="string">".app { ... }"</span>,
    <span class="property">"js_content"</span>: <span class="string">"function init() { ... }"</span>,
    <span class="property">"updated_at"</span>: <span class="string">"2024-01-15T10:30:00Z"</span>
  }
}</pre>
            </div>
        </div>

        <h2>Example: Todo App</h2>
        <p>Here's a complete example of a todo app built with Smack Apps.</p>

        <div class="code-block">
            <div class="code-header"><span>HTML</span></div>
            <div class="code-content">
<pre>&lt;div class=<span class="string">"todo-app"</span>&gt;
  &lt;h1&gt;My Todos&lt;/h1&gt;
  &lt;div class=<span class="string">"add-form"</span>&gt;
    &lt;input type=<span class="string">"text"</span> id=<span class="string">"newTodo"</span> placeholder=<span class="string">"Add a new todo..."</span>&gt;
    &lt;button onclick=<span class="string">"addTodo()"</span>&gt;Add&lt;/button&gt;
  &lt;/div&gt;
  &lt;ul id=<span class="string">"todoList"</span>&gt;&lt;/ul&gt;
&lt;/div&gt;</pre>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>CSS</span></div>
            <div class="code-content">
<pre>.todo-app {
  max-width: 500px;
  margin: 40px auto;
  font-family: -apple-system, sans-serif;
}

.add-form {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
}

.add-form input {
  flex: 1;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
}

.add-form button {
  padding: 12px 24px;
  background: #6366f1;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

#todoList {
  list-style: none;
  padding: 0;
}

#todoList li {
  padding: 12px;
  background: #f5f5f5;
  margin-bottom: 8px;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
}</pre>
            </div>
        </div>

        <div class="code-block">
            <div class="code-header"><span>JavaScript</span></div>
            <div class="code-content">
<pre><span class="keyword">async function</span> init() {
  <span class="comment">// Create table if not exists</span>
  <span class="keyword">await</span> SmackDB.query(<span class="string">`
    CREATE TABLE IF NOT EXISTS todos (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title TEXT NOT NULL,
      done INTEGER DEFAULT 0
    )
  `</span>);

  loadTodos();
}

<span class="keyword">async function</span> loadTodos() {
  <span class="keyword">const</span> result = <span class="keyword">await</span> SmackDB.query(<span class="string">"SELECT * FROM todos ORDER BY id DESC"</span>);
  <span class="keyword">const</span> list = document.getElementById(<span class="string">'todoList'</span>);
  list.innerHTML = result.rows.map(todo => <span class="string">`
    &lt;li&gt;
      &lt;span&gt;</span>${todo.title}<span class="string">&lt;/span&gt;
      &lt;button onclick="deleteTodo(</span>${todo.id}<span class="string">)"&gt;&amp;times;&lt;/button&gt;
    &lt;/li&gt;
  `</span>).join(<span class="string">''</span>);
}

<span class="keyword">async function</span> addTodo() {
  <span class="keyword">const</span> input = document.getElementById(<span class="string">'newTodo'</span>);
  <span class="keyword">if</span> (!input.value.trim()) <span class="keyword">return</span>;

  <span class="keyword">await</span> SmackDB.query(
    <span class="string">"INSERT INTO todos (title) VALUES (?)"</span>,
    [input.value]
  );

  input.value = <span class="string">''</span>;
  loadTodos();
}

<span class="keyword">async function</span> deleteTodo(id) {
  <span class="keyword">await</span> SmackDB.query(<span class="string">"DELETE FROM todos WHERE id = ?"</span>, [id]);
  loadTodos();
}

init();</pre>
            </div>
        </div>
    </div>

    <footer>
        <p>Smack API Documentation</p>
    </footer>
</body>
</html>
